-- liquibase formatted sql

-- changeset YuriiYatsenko:1
CREATE TABLE person_info (
	id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE),
	address VARCHAR(255) NULL,
	photo oid NULL,
	email VARCHAR(255) NULL,
	first_name VARCHAR(255) NOT NULL,
	last_name VARCHAR(255) NOT NULL,
	passport VARCHAR(255) NULL,
	phone_number VARCHAR(255) NOT NULL,
	CONSTRAINT person_info_PK PRIMARY KEY (id)
);

CREATE TABLE person (
	id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE),
	chat_id BIGINT NOT NULL,
	state VARCHAR(255) NOT NULL,
	user_name VARCHAR(255) NOT NULL,
	info_id BIGINT NULL,
	CONSTRAINT person_PK PRIMARY KEY (id),
	CONSTRAINT FK_person_info_constraint FOREIGN KEY (info_id) REFERENCES person_info(id)
);

CREATE TABLE shelter (
	id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE),
	address VARCHAR(255) NULL,
	photo oid NULL,
	"name" VARCHAR(255) NULL,
	"type" VARCHAR(255) NULL,
	CONSTRAINT shelter_PK PRIMARY KEY (id)
);

CREATE TABLE pet (
	id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1 NO CYCLE),
	age INTEGER NULL,
	breed VARCHAR(255) NULL,
	photo oid NULL,
	description VARCHAR(255) NULL,
	gender VARCHAR(255) NULL,
	"name" VARCHAR(255) NULL,
	"type" VARCHAR(255) NULL,
	shelter_id BIGINT NOT NULL,
	owner_id BIGINT NOT NULL,
	CONSTRAINT pet_PK PRIMARY KEY (id),
	CONSTRAINT FK_person_constraint FOREIGN KEY (owner_id) REFERENCES person(id),
	CONSTRAINT FK_shelter_consraint FOREIGN KEY (shelter_id) REFERENCES shelter(id)
);

-- changeset RomanZeleinin:1
ALTER TABLE pet ALTER COLUMN owner_id DROP NOT NULL;
ALTER TABLE pet ALTER COLUMN shelter_id DROP NOT NULL;

-- changeset RomanZelenin:2
ALTER TABLE shelter ADD description VARCHAR(255) NULL;
